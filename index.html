<!DOCTYPE html>
<html>
<head>
	<title>glassfish-junit-rule</title>
	<meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
	<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
</head>
<body>



<xmp theme="united" style="display:none;">

<header class="inner">
<h1 id="project_title">glassfish-junit-rule</h1>
<h2 id="project_tagline">A JUnit Rule that controls an embedded Glassfish instance</h2>

<section id="downloads">
	<a class="zip_download_link" href="https://github.com/scheuchzer/glassfish-junit-rule/zipball/master">Download this project as a .zip file</a>
	<a class="tar_download_link" href="https://github.com/scheuchzer/glassfish-junit-rule/tarball/master">Download this project as a tar.gz file</a>
</section>
</header>

## Overview

[glassfish-junit-rule](https://github.com/scheuchzer/glassfish-junit-rule) provides a [JUnit Rule](https://github.com/junit-team/junit/wiki/Rules) that controls a embedded [Glassfish4](https://glassfish.java.net/) instance.

## Why not using Arquillian?

Yes, why not. [Arquillian](http://arquillian.org/) is a good tool for doing JEE testing. [glassfish-junit-rule](https://github.com/scheuchzer/glassfish-junit-rule) is not intended to replace Arquillian. It's more a tools for testing Glassfish specific features. This might be login modules and other stuff. Such things are not possible or hard to do with Arquillian. [glassfish-junit-rule](https://github.com/scheuchzer/glassfish-junit-rule) comes with absolutely no XML configuration. It's configured programmatically in your JUnit tests.

[glassfish-junit-rule](https://github.com/scheuchzer/glassfish-junit-rule) is a work in progress. Features are going to be implemented as needed. Maybe, the Glassfish rule might never reach feature complete.

## Usage

### Maven Dependency
Releases are available through the maven central repository.

```xml
<dependency>
	<groupId>com.java-adventures.junit</groupId>
	<artifactId>glassfish-junit-rule</artifactId>
	<version>0.1.0</version>
</dependency>
```
### Write a JUnit Test

The main class is the JUnit Rule ``com.ja.junit.rule.glassfish.GlassfishController``. Artifacts like applications, resource adapters, connections and pools are created with the ``create`` method. During the create call the removal of that artifact is autamatically registered for removal during the teardown phase of the JUnit test. Therefore, you don't have to care about cleanup. The ``create`` method takes one parameter of type ``AbstractAdminObject``. Use the static factory method of ``com.ja.junit.rule.glassfish.ConfigObject`` to create that parameter. It's recommended that you use static imports here.

Another important method is the ``lookup`` method. This method gives you acceess to JNDI.

Now let's see some examples

#### Test a Realm

Thie code has been taken from http://www.java-adventures.com/glassfish-jdbc-realm-salted/

```java
private final GlassfishPreStartConfigurator startCfg = new GlassfishPreStartConfigurator();

@Rule
public GlassfishController glassfish = new GlassfishController(startCfg)
		// create user and role tables
		.create(defaultUserAndGroupTables())
		// register the jdbc realm
		.create(jdbcAuthRealm("testRealm", "jdbcSaltRealm", JDBCRealm.class));

public JDBCRealmIT() throws URISyntaxException {
	// open a http port
	startCfg.setHttpPort(8642)
	// provide a login.conf that registers the needed login module
	.setLoginConf(new File(getClass().getClassLoader().getResource("login.conf").toURI()));
}

@Test
public void testLoginValidUser() throws Exception {
	// create a new user in the default database
	glassfish.create(user("test", "abc123", "test"));
	deployDummyApp();

	Response response = glassfish.executeHttpRequest("/test/dummy", "test",	"abc123");
	assertThat(response.getStatus(), is(200));
	assertThat(response.getContentAsString(), is("OK"));
}

private void deployDummyApp() {
	...
}
```
#### Test a Resource Adapter

This code has been taken from https://github.com/scheuchzer/outbound-connector

```java
@Rule
public GlassfishController gf = new GlassfishController(new GlassfishPreStartConfigurator());

@Test
public void testResourceAdapterDeploymentWithNoFormatProperty()
		throws Exception {
	// deploy the resource adapter archive
	gf.create(deployment(createRarArchive("someDummy.rar")));
	// create a connection pool
	gf.create(connectorConnectionPool("someDummy", DummyConnectionFactory.class, "someDummyPool", new Properties()));
	// create the resource
	gf.create(connectorResource("someDummyPool", "jca/someDummy"));
	// look up the resource
	DummyConnectionFactory factory = gf.lookup("jca/someDummy");	
	assertThat(factory, is(notNullValue()));
	// get the connection and invoke some method on it
	try (DummyConnection connection = factory.getConnection()) {
		assertThat(connection, is(notNullValue()));
		assertEquals(TimeDummyConnection.class, connection.getClass());
		String time = connection.getTime();
		...
	}
}
```

## Author

- Thomas Scheuchzer 
  - http://java-adventures.com
  - https://github.com/scheuchzer


<a href="https://github.com/scheuchzer/glassfish-junit-rule"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 1000; margin: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38311626-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</xmp>
<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>
</body>

</html>
